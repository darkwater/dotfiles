#!/bin/bash

set -eu

export INPUT_PASSWORD="$(fuzzel --dmenu \
    --prompt-only="Password: "\
    --password \
    --cache=/dev/null)"
export BW_SESSION="$(bw unlock --passwordenv INPUT_PASSWORD --raw)"
unset INPUT_PASSWORD

bw list items |
    jq -r '.[] | "\(.login.password)\t\(.login.username)@\(.name)"' |
    fuzzel --dmenu \
        --accept-nth=1 \
        --with-nth=2 \
        --width=50 \
        --cache=$HOME/.cache/fuzzel-bw |
    if read line; then
        echo -n "$line" | wl-copy
    fi
